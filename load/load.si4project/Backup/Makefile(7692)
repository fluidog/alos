OBJS:=load.o ext2.o fat.o memory.o 

CFALG:=-I include -fno-asynchronous-unwind-tables 
TEXT_BASE:=0x10000
LDFLAG:=-Ttext $(TEXT_BASE) -T load.lds 
DEV := /dev/sda
DIR := include/
	
load.bin:$(OBJS) 
	ld $(LDFLAG) -nostartfiles -e main -o load.elf $^
	objcopy -O binary -S load.elf $@
	mount $(DEV)  $(DIR)
	cp $@ $(DIR)
	umount $(DIR)

%.o:%.c
	$(CC) $(CFALG) -c $< 


.PHONY :clean load.bin
clean :
	rm -f *.o load.bin load.elf 
